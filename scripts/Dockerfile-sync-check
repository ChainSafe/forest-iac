FROM fedora:36

# Install dependencies
RUN dnf -y install dnf-plugins-core-4.3.1 && \
    dnf config-manager \
        --add-repo \
        https://download.docker.com/linux/fedora/docker-ce.repo && dnf clean all

# Install dependencies
RUN dnf -y install \
    docker-ce-3:23.0.2 \
    docker-ce-cli-20.10.15 \
    containerd.io-1.6.10 \
    docker-buildx-plugin-0.10.2 \
    docker-compose-plugin-2.10.2 \
    docker-compose-1.29.2 \
    ruby-3.1.3 \
    ruby-devel-3.1.3 \
    make-4.3 \
    gcc-12.2.1 \
    && dnf clean all

WORKDIR /chainsafe

COPY Gemfile Gemfile.lock ./

RUN gem install bundler:2.3.4 && bundle install

COPY ruby_common ruby_common
COPY sync_check/* ./

# Use shell form of ENTRYPOINT
ENTRYPOINT ["/bin/bash", "run_service.sh"]
